#cloud-config
mounts:
  {% for nfs_cfg in nfs_configurations %}
  - ["{{ nfs_cfg.nfs_server }}:{{ nfs_cfg.nfs_export }}", "{{ nfs_cfg.nfs_client_mnt_point }}", "nfs", "defaults", "0", "0"]
  {% endfor %}

write_files:
  - path: /etc/sysconfig/slurmd
    encoding: text/plain
    permissions: "0644"
    owner: root:root
    content: SLURMD_OPTIONS='--conf-server {{ openhpc_slurm_control_host }}'
  - path: /etc/openstack/clouds.yaml
    encoding: text/plain
    permissions: "0400"
    owner: root:root
    content: |
      {{ lookup('file', openhpc_rebuild_clouds, errors=( 'strict' if groups['rebuild'] else 'ignore')) | indent(width=6, first=false) }}
  - path: /etc/munge/munge.key
    encoding: base64
    permissions: "0400"
    owner: munge:munge
    content: ${ openhpc_munge_key }
